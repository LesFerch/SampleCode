<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" http-equiv="X-UA-Compatible" content="IE=9">
<hta:application
  singleinstance=yes
>
<script language="VBScript">

'Issue #1: singleinstance=yes is not supported
'"Convert into Executable" should provide a "Single Instance" option.

Set oWSH = CreateObject("Wscript.Shell")
Set oFSO = CreateObject("Scripting.FileSystemObject")

'Issue #2: Document.URL is different than running HTA via MSHTA
'I parse Document.URL to get the script's folder
'I can workaround the issue with the following code:

If InStr(document.URL,"res://") Then X=7 Else X=8
MyPath = Mid(document.URL,x)
MyFolder = oFSO.GetParentFolderName(MyPath)
If X=7 Then MyFolder = oFSO.GetParentFolderName(MyFolder)
oWSH.CurrentDirectory = MyFolder

document.title = "Initial Title"

'Issue #3: Backslashes in variables containing a relative path, that are used to load a dependent file, get changed to vertical bars
'See the result of MsgBox in the ModalDialogTest below
'This one took a lot of testing to narrow down.

ModalHTA = ".\Modal.hta"
 
'Issue #4: ShowModalDialog title includes the text "-- Webpage Dialog"
'This is really ugly and unacceptable.

'Issue #5: If an HTA, launched via ShowModalDialog, uses an ActiveX control, such as "Wscript.Shell", the following warning dialog pops up:
'An ActiveX control on this page might be unsafe to
'interact with other parts of the page. Do you want to
'allow this interaction?

Sub ModalDialogTest
  DialogArgs = "Dialog Test;Dialog message"
  DialogOptions = "Scroll:No; DialogWidth:20em; DialogHeight:10em; dialogLeft:" & window.screenLeft & "; dialogTop:" & window.screenTop
  Modal = ShowModalDialog(ModalHTA,DialogArgs,DialogOptions)
  MsgBox ModalHTA
End Sub

'Issue #6: document.title cannot be changed once the page has loaded
'I use this to change the title when the user selects a different language for the page

Sub window_OnLoad
  document.title = "New Title"
End Sub

'Issue #7: The code in window_OnBeforeUnload sub is not executed
'I use this to save the HTA current window size and position

Sub window_OnBeforeUnload
  oWSH.RegWrite "HKCU\Software\Test\WinSizePos",window.outerWidth & "," & window.outerHeight & "," & window.screenLeft & "," & window.screenTop
End Sub

</script>
<style>
</style>
</head>
<body>
<input type=button value='Modal Dialog Test' onClick=ModalDialogTest()>
</body>
</html>